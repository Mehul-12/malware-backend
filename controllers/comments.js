  if (process.env.NODE_ENV !== "production") {
    require('dotenv').config();
  }
  const secret = process.env.SECRET;
  const express = require('express');
  const mongoose = require('mongoose');

  const User = require('../models/user');
  const Comment = require('../models/comment');
  const Post = require('../models/post');

  module.exports.createComment = async (req, res) => {
    console.log(req.user);
    const user = await User.findById(req.user._id)
    console.log("test continued");
    // console.log(user._id);

    const authorid=user._id
    const authorname=user.name;
    
    const {description} = req.body;  
  try {  
    const { id } = req.params;
    const post = await Post.findById(id);
    const result = await Comment.create({ description,authorid,authorname});
    console.log(result);
    post.comments.push(result);
    const updatedPost = await Post.findByIdAndUpdate(id, {...post}, { new: true });
    res.status(200).json(updatedPost);
    
  } catch (error) {
      res.status(500).json({ message: "Comment Not added" });    
      console.log(error);
    }
  };

  module.exports.deleteComment = async (req, res) => {
    try{
    const { id, commentid } = req.params;
    const updatedPost = await Post.findByIdAndUpdate(id, { $pull: { comments: commentid } });
    await Comment.findByIdAndDelete(commentid);
    const post= await Post.findById(id);
    res.status(200).json(post);
    }
    catch (error) {
      res.status(500).json({ message: "Comment can not be deleted" });    
      console.log(error);
    }
};
module.exports.updateComment = async (req, res) => {
  try{
  const { id, commentid } = req.params;
  const updatedcomment=await Comment.findByIdAndUpdate(commentid,{...req.body},{new:true});
  // const updatedPost = await Post.findByIdAndUpdate(id, { $pull: { comments: commentid } });
  // await Comment.findByIdAndDelete(commentid);
  // const post= await Post.findById(id);
  res.status(200).json(updatedcomment);
  }
  catch (error) {
    res.status(500).json({ message: "Comment Not be Updated" });    
    console.log(error);
  }
};